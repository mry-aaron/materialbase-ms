<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org/">
<head>
    <meta charset="UTF-8">
    <title>Home</title>

    <!-- 引入CSS样式表 -->
    <link rel="stylesheet" href="http://192.168.0.125/css/reset.css">
    <link rel="stylesheet" href="http://192.168.0.125/css/bootstrap.min.css">
    <link rel="stylesheet" href="http://192.168.0.125/css/styles.css">
    <link rel="stylesheet" href="http://192.168.0.125/css/media.css">
    <!-- banner CSS -->
    <link rel="stylesheet" href="http://192.168.0.125/css/banner.css">
    <!-- card CSS -->
    <link rel="stylesheet" th:href="@{/static/layui/css/layui.css}">
    <link rel="stylesheet" href="http://192.168.0.125/css/ml_card.css">

</head>
<body>
<!-- 头部信息 -->
<div class="header">
    <!-- 顶部导航栏 -->
    <div th:replace="~{pages/iframe/navbar.html::topNav}"></div>
</div>

<!-- 主体信息 -->
<div class="main-container">
    <!-- 左侧导航栏 -->
    <div th:replace="~{pages/iframe/navbar::leftNav(activeUri='index.html')}"></div>
    <!-- 主体内容 -->
    <div class="content">
        <div class="container-fluid">
            <!-- 图片轮播 -->
            <div class="banner">
                <div class="banner_t rel">
                    <div class="banner_t_left abs" hidden><a href="#"><img src="http://192.168.0.125/images/icon/banner_l.png" alt=""/></a></div>
                    <span class="jianbian"></span>
                    <div id="boxgallery" class="boxgallery" data-effect="effect-1"></div>
                    <div class="banner_t_right abs" hidden><a href="#"><img src="http://192.168.0.125/images/icon/banner_r.png"  alt=""/></a></div>
                </div>
            </div>
            <!-- 素材展示 -->
            <div class="material">
                <!-- 标题 -->
                <div class="ml_title"><span class="sc_text">素材</span>展示</div>
                <!-- 素材模块 -->
                <div class="ml_list">
                    <!--<div class="ml_row">
                        <div class="ml_card">
                            <div class="card_img">
                                <a href="#"><img src="http://192.168.0.125/images/materialbase/top_1.jpg" alt=""></a>
                                <div class="card_tag">
                                    <a href="#"><i class="icon-follow"></i></a>
                                    <a href="#"><i class="icon-download"></i></a>
                                </div>
                            </div>
                            <div class="card_title">
                                <p>春光无限好</p>
                                <p>
                                    <i class="follow_icon"></i>
                                    <span class="follow_count">0</span>
                                    <i class="download_icon"></i>
                                    <span class="download_count">0</span>
                                </p>
                            </div>
                        </div>
                    </div>-->
                </div>
                <!-- 分页DIV -->
                <div class="ml_pages">
                    <div id="pages"></div>
                </div>
            </div>
            <!-- 信息 -->
            <div class="content_bottom">
                <div class="bottom_a">
                    <span><a href="#">加入收藏</a></span>
                    <span>|</span>
                    <span><a href="#">招聘信息</a></span>
                    <span>|</span>
                    <span><a href="#">免责条款</a></span>
                    <span>|</span>
                    <span><a href="#">版权声明</a></span>
                    <span>|</span>
                    <span><a href="#">联系我们</a></span>
                </div>
                <div class="bottom_copyright">Copyright 2001-2019 核桃林传媒,版权所有 京ICP备11076239号 公网监备2301000264</div>
                <div class="bottom_contact">网站合作、内容监督：010-5960 3139/5960 3132   QQ:2975 09268</div>
            </div>
        </div>
    </div>
</div>
<div class="hidden_msg" style="display: none" th:text="${session.sign_msg}"></div>
</body>

<!-- 引入JS库 -->
<script type="text/javascript" src="http://192.168.0.125/js/jquery-3.3.1.min.js"></script>
<script type="text/javascript" src="http://192.168.0.125/js/bootstrap.min.js"></script>
<script type="text/javascript" src="http://192.168.0.125/js/carbon.js"></script>
<script type="text/javascript" th:src="@{/static/layui/layui.js}"></script>
<script type="text/javascript" src="http://192.168.0.125/js/sign.js"></script>
<!-- banner JS -->
<script type="text/javascript" src="http://192.168.0.125/js/modernizr.custom.js"></script>
<script type="text/javascript" src="http://192.168.0.125/js/banner.js"></script>
<!-- 渲染数据 -->
<script type="text/javascript">
    // 素材路径
    var filePath = "http://192.168.0.125/images/upload/materialbase/picture/";
    // 图片轮播
    $(function () {
        $.post("/homebanner", "", function (data) {
            var jsonObj = JSON.parse(data);
            $(".banner_t .boxgallery").html(null);
            for(var v in jsonObj){
                $(".banner_t .boxgallery").append("<div class='panel'>" +
                    "<img src='" + (filePath + jsonObj[v]["materialPath"]) + "'/></div>");
            }
            new BoxesFx( document.getElementById( 'boxgallery' ) );
        });
    });
    // 展示所有素材
    $(function () {
        var curr = 1;
        /* 获取数据 */
        function getPageData(){
            $.ajax({
                type: 'POST',
                url: '/getallpicsm',
                data: {page:curr,limit: 8},
                dataType: 'json',
                success: function (data) {
                    paged(data);
                }
            });
        };
        /* 实现分页 */
        function paged(_data){
            var jsonData = _data["data"];
            layui.use(['laypage', 'layer'], function() {
                var laypage = layui.laypage, layer = layui.layer;
                laypage.render({
                    elem: 'pages'
                    , count: _data["total"]
                    , layout: ['prev', 'page', 'next', 'count', 'skip']
                    , limit: 8
                    , curr: curr
                    , jump: function (obj, first) {
                        curr = obj.curr;
                        if(!first){ // 排除初始化加载
                            getPageData();
                        }
                        $(".ml_list").html(null);
                        var appendStr = ['<div class="ml_row">'];
                        for(var i = 0; i < jsonData.length; i++){
                            appendStr.push('<div class="ml_card">');
                            appendStr.push('<div class="card_img">');
                            appendStr.push('<a href="#"><img src="'+ (filePath+jsonData[i]["materialPath"]) +'"></a>');
                            appendStr.push('<div class="card_tag">');
                            appendStr.push('<a href="#"><i class="icon-follow"></i></a>');
                            var namesuffix = jsonData[i]["materialPath"].split(".");
                            appendStr.push('<a href="/download?id='+ namesuffix[0] +'&format='+ namesuffix[1] +'"><i class="icon-download"></i></a>');
                            appendStr.push('</div>');
                            appendStr.push('</div>');
                            appendStr.push('<div class="card_title">');
                            appendStr.push('<p>'+ jsonData[i]["productName"] +'</p>');
                            appendStr.push('<p>');
                            appendStr.push('<i class="follow_icon"></i><span class="follow_count">'+ jsonData[i]["like"] +'</span>');
                            appendStr.push('<i class="download_icon"></i><span class="download_count">'+ jsonData[i]["download"] +'</span>');
                            appendStr.push('</p>');
                            appendStr.push('</div>');
                            appendStr.push('</div>');
                            if((i+1) % 4 == 0){
                                appendStr.push('</div><div class="ml_row">');
                            }
                        }
                        appendStr.push('</div>');
                        $(".ml_list").html(appendStr.join(''));
                    }
                });
            });
        }
        getPageData();
    });
</script>

<!-- JS监听屏幕改变 -->
<script type="text/javascript" src="http://192.168.0.125/js/screen_set.js"></script>
</html>